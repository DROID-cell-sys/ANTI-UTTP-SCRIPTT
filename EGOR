local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

-- Wait for LocalPlayer (some executors inject too early)
local player = Players.LocalPlayer
while not player do
	task.wait()
	player = Players.LocalPlayer
end

-- Wait for PlayerGui
local playerGui = player:WaitForChild("PlayerGui")

-- Create GUI
local gui = Instance.new("ScreenGui")
gui.Name = "EgorToggle"
gui.ResetOnSpawn = false
gui.Parent = playerGui

local watermark = Instance.new("TextLabel")
watermark.Size = UDim2.new(0, 180, 0, 30)
watermark.Position = UDim2.new(1, -190, 0, 10)
watermark.BackgroundTransparency = 1
watermark.TextColor3 = Color3.new(1, 1, 1)
watermark.TextStrokeTransparency = 0.7
watermark.Font = Enum.Font.SourceSansBold
watermark.TextSize = 18
watermark.Text = "MADE BY TABLE-V6W"
watermark.TextXAlignment = Enum.TextXAlignment.Right
watermark.Parent = gui

local button = Instance.new("TextButton")
button.Size = UDim2.new(0, 130, 0, 40)
button.Position = UDim2.new(0, 10, 1, -60)
button.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
button.TextColor3 = Color3.new(1, 1, 1)
button.TextSize = 20
button.Font = Enum.Font.SourceSansBold
button.Text = "Egor: OFF"
button.Parent = gui

local egorEnabled = false
local runAnimId = "rbxassetid://913376220"
local runTrack, runConnection

local function stopRunAnimation()
	if runTrack then
		runTrack:Stop()
		runTrack:Destroy()
		runTrack = nil
	end
	if runConnection then
		runConnection:Disconnect()
		runConnection = nil
	end
end

local function playRunAnimation(humanoid)
	stopRunAnimation()

	local animator = humanoid:FindFirstChildWhichIsA("Animator") or Instance.new("Animator", humanoid)

	local runAnim = Instance.new("Animation")
	runAnim.AnimationId = runAnimId

	runTrack = animator:LoadAnimation(runAnim)
	runTrack.Priority = Enum.AnimationPriority.Movement
	runTrack:AdjustSpeed(6)
	runTrack:Play()

	runConnection = RunService.RenderStepped:Connect(function()
		if humanoid.MoveDirection.Magnitude == 0 then
			if runTrack.IsPlaying then runTrack:Stop() end
		else
			if not runTrack.IsPlaying then
				runTrack:Play()
				runTrack:AdjustSpeed(6)
			end
		end
	end)
end

local function enableEgor()
	local char = player.Character
	if not char then return end
	local humanoid = char:FindFirstChild("Humanoid")
	if not humanoid then return end

	humanoid.WalkSpeed = 3
	playRunAnimation(humanoid)
	button.Text = "Egor: ON"
end

local function disableEgor()
	local char = player.Character
	if not char then return end
	local humanoid = char:FindFirstChild("Humanoid")
	if not humanoid then return end

	humanoid.WalkSpeed = 16
	stopRunAnimation()
	button.Text = "Egor: OFF"
end

button.MouseButton1Click:Connect(function()
	egorEnabled = not egorEnabled
	if egorEnabled then enableEgor() else disableEgor() end
end)

local function onCharacterAdded(char)
	local humanoid = char:WaitForChild("Humanoid")
	char:WaitForChild("Animate")
	task.wait(0.5)

	if egorEnabled then
		enableEgor()
	else
		disableEgor()
	end

	humanoid.Died:Connect(stopRunAnimation)
end

-- Wait for character if not loaded yet
if player.Character then
	onCharacterAdded(player.Character)
else
	player.CharacterAdded:Connect(onCharacterAdded)
end
	end

	local runAnim = Instance.new("Animation")
	runAnim.AnimationId = runAnimId

	runTrack = animator:LoadAnimation(runAnim)
	runTrack.Priority = Enum.AnimationPriority.Movement
	runTrack:AdjustSpeed(6)
	runTrack:Play()

	runConnection = RunService.RenderStepped:Connect(function()
		if humanoid.MoveDirection.Magnitude == 0 then
			if runTrack.IsPlaying then
				runTrack:Stop()
			end
		else
			if not runTrack.IsPlaying then
				runTrack:Play()
				runTrack:AdjustSpeed(6)
			end
		end
	end)
end

local function enableEgor()
	local char = player.Character
	if not char then return end
	local humanoid = char:FindFirstChild("Humanoid")
	if not humanoid then return end

	humanoid.WalkSpeed = 3
	playRunAnimation(humanoid)
	button.Text = "Egor: ON"
end

local function disableEgor()
	local char = player.Character
	if not char then return end
	local humanoid = char:FindFirstChild("Humanoid")
	if not humanoid then return end

	humanoid.WalkSpeed = 16
	stopRunAnimation()
	button.Text = "Egor: OFF"
end

button.MouseButton1Click:Connect(function()
	egorEnabled = not egorEnabled
	if egorEnabled then
		enableEgor()
	else
		disableEgor()
	end
end)

local function onCharacterAdded(char)
	local humanoid = char:WaitForChild("Humanoid")
	char:WaitForChild("Animate")
	task.wait(0.5)

	if egorEnabled then
		enableEgor()
	else
		disableEgor()
	end

	-- Cleanup on death to avoid lingering connections
	humanoid.Died:Connect(function()
		stopRunAnimation()
	end)
end

if player.Character then
	onCharacterAdded(player.Character)
end
player.CharacterAdded:Connect(onCharacterAdded)
