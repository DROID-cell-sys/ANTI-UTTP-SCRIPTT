local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local DEFAULT_WALK_SPEED = 16
local EGOR_WALK_SPEED = 3
local RUN_ANIMATION_ID = "rbxassetid://913376220"

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

local gui = Instance.new("ScreenGui")
gui.Name = "EgorToggleGui"
gui.ResetOnSpawn = false
gui.Parent = playerGui

local watermark = Instance.new("TextLabel")
watermark.Size = UDim2.new(0, 180, 0, 30)
watermark.Position = UDim2.new(1, -190, 0, 10)
watermark.BackgroundTransparency = 1
watermark.TextColor3 = Color3.new(1, 1, 1)
watermark.TextStrokeTransparency = 0.7
watermark.Font = Enum.Font.SourceSansBold
watermark.TextSize = 18
watermark.Text = "MADE BY TABLE-V6W"
watermark.TextXAlignment = Enum.TextXAlignment.Right
watermark.Parent = gui

local button = Instance.new("TextButton")
button.Size = UDim2.new(0, 130, 0, 40)
button.Position = UDim2.new(0, 10, 1, -60)
button.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
button.TextColor3 = Color3.new(1, 1, 1)
button.TextSize = 20
button.Font = Enum.Font.SourceSansBold
button.Text = "Egor: OFF"
button.Parent = gui

local egorEnabled = false
local runTrack, runConnection

local function stopRunAnimation()
	if runTrack then
		runTrack:Stop()
		runTrack:Destroy()
		runTrack = nil
	end
	if runConnection then
		runConnection:Disconnect()
		runConnection = nil
	end
end

local function getOrCreateAnimator(humanoid)
	return humanoid:FindFirstChildWhichIsA("Animator") or Instance.new("Animator", humanoid)
end

local function playRunAnimation(humanoid)
	stopRunAnimation()
	local animator = getOrCreateAnimator(humanoid)
	local runAnim = Instance.new("Animation")
	runAnim.AnimationId = RUN_ANIMATION_ID
	runTrack = animator:LoadAnimation(runAnim)
	runTrack.Priority = Enum.AnimationPriority.Movement
	runTrack:AdjustSpeed(6)
	runTrack:Play()
	runConnection = RunService.RenderStepped:Connect(function()
		if humanoid.MoveDirection.Magnitude == 0 then
			if runTrack.IsPlaying then runTrack:Stop() end
		else
			if not runTrack.IsPlaying then
				runTrack:Play()
				runTrack:AdjustSpeed(6)
			end
		end
	end)
end

local function enableEgor()
	local char = player.Character
	if not char then return end
	local humanoid = char:FindFirstChild("Humanoid")
	if not humanoid then return end
	humanoid.WalkSpeed = EGOR_WALK_SPEED
	playRunAnimation(humanoid)
	button.Text = "Egor: ON"
	egorEnabled = true
end

local function disableEgor()
	local char = player.Character
	if not char then return end
	local humanoid = char:FindFirstChild("Humanoid")
	if not humanoid then return end
	humanoid.WalkSpeed = DEFAULT_WALK_SPEED
	stopRunAnimation()
	button.Text = "Egor: OFF"
	egorEnabled = false
end

button.MouseButton1Click:Connect(function()
	if egorEnabled then
		disableEgor()
	else
		enableEgor()
	end
end)

local function onCharacterAdded(char)
	local humanoid = char:WaitForChild("Humanoid")
	char:WaitForChild("Animate")
	task.wait(0.5)
	if egorEnabled then
		enableEgor()
	else
		disableEgor()
	end
	humanoid.Died:Connect(stopRunAnimation)
end

if player.Character then
	onCharacterAdded(player.Character)
end
player.CharacterAdded:Connect(onCharacterAdded)
